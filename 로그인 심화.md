서버에 평문(plain text) 비밀번호를 저장하면 절대 안 되고, 대신 해시(단방향 암호화) 해서 저장하고 로그인할 때는 입력한 평문 비밀번호를 해시와 비교해야 합니다. Spring 생태계에서는 BCrypt가 표준적으로 널리 쓰입니다. 아래에 안전하고 실무적인 방법을 정리해드릴게요: 설정, 코드 예시(회원가입/로그인), DB 타입, 마이그레이션/운영 팁까지 모두 포함합니다.

1) 개념 요약 — 핵심 원칙

비밀번호는 단방향 해시(예: BCrypt) 로 저장. 복호화 불가.

로그인: 클라이언트가 보낸 평문 비밀번호를 서버에서 해시화된 값과 비교(match).

반드시 HTTPS 사용: 네트워크 전송 중 탈취 방지.

BCrypt는 내부적으로 salt(랜덤값)를 자동 추가 → 같은 비밀번호도 매번 다른 해시가 됨.

2) 의존성 (Spring Boot 사용 시)

Spring Security를 쓰면 BCryptPasswordEncoder를 바로 사용 가능:

<!-- pom.xml -->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-security</artifactId>
</dependency>


(만약 Spring Security 전체를 도입하기 싫으면 spring-security-crypto만 추가 가능.)

3) Bean 설정 (PasswordEncoder)
@Configuration
public class SecurityConfig {
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder(); // 기본 strength 10 (원한다면 new BCryptPasswordEncoder(12))
    }
}

4) 회원가입 로직 — 비밀번호 해시해서 저장

예: service에서 저장하기 전에 인코딩

@Service
public class MemberServiceImpl implements MemberService {
    private final MemberRepository memberRepository;
    private final PasswordEncoder passwordEncoder;

    public MemberServiceImpl(MemberRepository memberRepository, PasswordEncoder passwordEncoder) {
        this.memberRepository = memberRepository;
        this.passwordEncoder = passwordEncoder;
    }

    @Override
    public void signup(MemberDto dto) {
        String rawPwd = dto.getPwd();
        String encodedPwd = passwordEncoder.encode(rawPwd);

        Member member = new Member();
        member.setId(dto.getId());
        member.setPwd(encodedPwd);   // ← 평문이 아닌 해시 저장
        member.setName(dto.getName());
        member.setEmail(dto.getEmail());
        // ... 기타 필드

        memberRepository.save(member); // JPA, JdbcTemplate 등 사용
    }
}


DB 컬럼은 충분한 길이 필요 (VARCHAR(60) 이상 — BCrypt는 보통 60자).

5) 로그인 로직 — 입력 비밀번호와 해시 비교
@Override
public boolean login(String id, String rawPwd) {
    Member member = memberRepository.findById(id);
    if (member == null) return false; // 아이디 없음

    String storedEncodedPwd = member.getPwd();
    boolean matches = passwordEncoder.matches(rawPwd, storedEncodedPwd);
    return matches; // true이면 로그인 성공
}


passwordEncoder.matches(raw, encoded) 가 내부적으로 salt를 사용해 비교합니다.

절대 평문 비교( rawPwd.equals(stored) ) 하지 마세요.

6) JdbcTemplate 예시 (현재 코드 스타일에 맞춘 예)

회원 조회:

public Member findById(String id) {
    String sql = "SELECT id, pwd, name, email FROM member WHERE id = ?";
    try {
        return jdbcTemplate.queryForObject(sql, (rs, rowNum) -> {
            Member m = new Member();
            m.setId(rs.getString("id"));
            m.setPwd(rs.getString("pwd"));
            m.setName(rs.getString("name"));
            m.setEmail(rs.getString("email"));
            return m;
        }, id);
    } catch (EmptyResultDataAccessException e) {
        return null;
    }
}


로그인:

public boolean login(Member memberInput) {
    Member stored = memberRepository.findById(memberInput.getId());
    if (stored == null) return false;
    return passwordEncoder.matches(memberInput.getPwd(), stored.getPwd());
}

7) DB 스키마 주의

pwd 컬럼 타입: VARCHAR(60) 이상 권장 (BCrypt는 일반적으로 60자).

ALTER TABLE member MODIFY COLUMN pwd VARCHAR(100) NOT NULL;

8) 기존 사용자(이미 평문 저장된 경우) 마이그레이션 전략

안전한 방법: 회원 가입 및 비밀번호 변경 시점에만 해시 저장. 기존 사용자의 평문이 DB에 있으면 로그인 시 평문인지 해시인지 판별 후:

로그인 시 DB 값이 평문으로 들어있다면 passwordEncoder.encode(raw)와 비교하지 말고 raw.equals(stored)로 확인(임시).

로그인 성공 시 새 해시로 업데이트: update member set pwd = :encoded where id = :id.

또는 DB 전체를 강제 초기화(사용자에게 비밀번호 리셋 안내) — UX/보안 정책에 따라 선택.

권장: 가능한 한 빨리 모든 비밀번호를 해시로 바꾸세요.

9) 추가 보안 권장사항 (실무)

HTTPS 필수.

로그인 시 브루트포스 방지(레이트 리밋, 캡차, 계정 잠금).

비밀번호 정책(최소 길이, 복잡도) + 비밀번호 유효기간(조심해서 적용).

비밀번호 재설정 토큰은 랜덤, 짧은 만료 시간, 한 번만 사용.

민감 정보(비밀번호 제외)도 필요하면 암호화 고려.

감사 로그 기록(다만 비밀번호는 절대 로그에 남기지 마세요).

로그인 성공/실패 기록 및 모니터링.

10) 테스트 권장 절차

회원가입 -> DB에 pwd가 평문이 아닌 $2a$... 형식으로 저장되는지 확인.

로그인: 올바른 비밀번호로 로그인 성공, 틀리면 실패.

기존 사용자 마이그레이션(있다면) 동작 확인.

요약 (한 문장)

회원가입 시 PasswordEncoder#encode(raw)로 비밀번호 해시를 저장하고, 로그인 시 PasswordEncoder#matches(raw, storedHash)로 비교하세요. Spring의 BCryptPasswordEncoder를 사용하면 salt 자동 처리와 안전한 비교가 보장됩니다.

원하면 지금 코드(회원가입, 로그인 서비스, Member 엔티티/테이블 정의)를 붙여주시면, 바로 수정 가능한 코드 스니펫으로 바꿔드릴게요.